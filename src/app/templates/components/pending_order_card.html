<div class="glass rounded-lg p-3 mb-2 card-hover pending-order-card" data-pending-order-id="{{ order_id }}" data-pending-symbol="{{ symbol|upper }}">
    <div class="flex justify-between items-center mb-2">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center border border-yellow-500/40">
                <span class="font-bold text-white text-sm">{{ symbol }}</span>
            </div>
            <div>
                <div class="flex items-center gap-2">
                    <div class="font-bold text-white">{{ symbol }}</div>
                    <span class="order-status-pending text-[10px] px-2 py-0.5 rounded-full font-semibold">
                        <i data-lucide="clock" class="text-xs mr-1 w-3 h-3"></i>PENDING
                    </span>
                </div>
                <div class="text-xs text-yellow-400 font-semibold">{{ side.upper() }} Order â€¢ {{ qty }} shares</div>
                <div class="text-xs text-gray-400">
                    {% if order_type.upper() == 'MARKET' %}
                        MARKET ORDER
                    {% else %}
                        {{ order_type.upper() }}{% if limit_price %} @ ${{ "%.2f"|format(limit_price) }}{% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="text-right">
            <div class="text-xs text-gray-400">Order ID</div>
            <div class="text-xs text-gray-500 font-mono">{{ order_id[:8] }}...</div>
        </div>
    </div>
    {% if stop_loss and take_profit %}
    <div class="mb-2 pt-2 border-t border-yellow-500/20">
        <div class="grid grid-cols-2 gap-2 text-xs">
            <div class="glass rounded p-1.5 bg-red-500/10 border border-red-500/30">
                <div class="text-gray-400">Stop Loss</div>
                <div class="text-red-400 font-bold">${{ "%.2f"|format(stop_loss) }}</div>
            </div>
            <div class="glass rounded p-1.5 bg-green-500/10 border border-green-500/30">
                <div class="text-gray-400">Take Profit</div>
                <div class="text-green-400 font-bold">${{ "%.2f"|format(take_profit) }}</div>
            </div>
        </div>
    </div>
    {% endif %}
    
    {# Order Status Information Section #}
    {% if current_price is not none or status_message or not market_open %}
    <div class="mb-2 pt-2 border-t border-yellow-500/20">
        <div class="space-y-2">
            {# Market Status Badge #}
            <div class="flex items-center gap-2">
                {% if market_open %}
                <span class="text-[10px] px-2 py-0.5 rounded-full font-semibold bg-green-500/20 text-green-400 border border-green-500/40">
                    <i data-lucide="circle" class="text-xs mr-1 w-2 h-2 inline-block"></i>Market Open
                </span>
                {% else %}
                <span class="text-[10px] px-2 py-0.5 rounded-full font-semibold bg-gray-500/20 text-gray-400 border border-gray-500/40">
                    <i data-lucide="circle-off" class="text-xs mr-1 w-2 h-2 inline-block"></i>Market Closed
                </span>
                {% endif %}
            </div>
            
            {# Current Price Display #}
            {% if current_price is not none %}
            <div class="flex items-center justify-between text-xs">
                <div class="text-gray-400">Current Price</div>
                <div class="font-bold {% if order_type.upper() == 'MARKET' %}text-green-400{% elif price_diff_pct is not none and price_diff_pct >= 0 %}text-green-400{% elif price_diff_pct is not none and price_diff_pct < 0 %}text-yellow-400{% else %}text-white{% endif %}">
                    ${{ "%.2f"|format(current_price) }}
                    {% if order_type.upper() != 'MARKET' and limit_price and price_diff_pct is not none %}
                        {% if price_diff_pct >= 0 %}
                            <span class="text-green-400 ml-1">({{ "%.1f"|format(price_diff_pct) }}% above limit)</span>
                        {% else %}
                            <span class="text-yellow-400 ml-1">({{ "%.1f"|format(price_diff_pct|abs) }}% below limit)</span>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            {# Status Message #}
            {% if status_message %}
            <div class="text-xs text-gray-300 bg-gray-500/10 rounded p-2 border border-gray-500/20">
                <i data-lucide="info" class="w-3 h-3 inline-block mr-1 align-middle"></i>
                {{ status_message }}
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <div class="flex gap-2 pt-2 border-t border-yellow-500/20">
        <button 
            hx-post="/api/cancel-order"
            hx-vals='{{ {"order_id": order_id} | tojson }}'
            hx-swap="none"
            hx-confirm="Cancel {{ side.upper() }} order for {{ symbol|e }}?"
            hx-on::before-request="
                // Instant visual feedback: fade-out and disable button
                // Let server response handle actual removal via hx-swap-oob
                const orderCard = event.target.closest('[data-pending-order-id]');
                const cancelButton = event.target;
                if (orderCard) {
                    // Store original state for error recovery
                    orderCard.setAttribute('data-cancelling', 'true');
                    orderCard.classList.add('fade-out-cancel');
                    cancelButton.disabled = true;
                }
            "
            hx-on::response-error="
                // Restore card state if cancellation failed
                const orderCard = event.target.closest('[data-pending-order-id]');
                const cancelButton = event.target;
                if (orderCard) {
                    orderCard.removeAttribute('data-cancelling');
                    orderCard.classList.remove('fade-out-cancel');
                    cancelButton.disabled = false;
                }
            "
            class="flex-1 glass-strong py-1.5 rounded-lg text-xs font-bold text-white hover:bg-red-600/30 transition-all bg-red-500/30 flex items-center justify-center gap-1 border border-red-500/50">
            <span class="htmx-indicator">
                <i data-lucide="loader-2" class="text-xs w-3 h-3 lucide-spin"></i>
            </span>
            <i data-lucide="x" class="text-xs w-3 h-3 htmx-indicator-hidden"></i>
            <span class="htmx-indicator-hidden">CANCEL</span>
            <span class="htmx-indicator">Canceling...</span>
        </button>
    </div>
</div>
