{% set type_config = {
    'success': {'border': 'border-green-500/30', 'bg': 'bg-green-500/10', 'icon': 'check-circle-2', 'icon_color': 'text-green-400'},
    'info': {'border': 'border-blue-500/30', 'bg': 'bg-blue-500/10', 'icon': 'info', 'icon_color': 'text-blue-400'},
    'warning': {'border': 'border-yellow-500/30', 'bg': 'bg-yellow-500/10', 'icon': 'alert-triangle', 'icon_color': 'text-yellow-400'},
    'error': {'border': 'border-red-500/30', 'bg': 'bg-red-500/10', 'icon': 'x-circle', 'icon_color': 'text-red-400'}
} %}
{% set config = type_config.get(type, type_config['info']) %}
<div id="{{ target_id }}" hx-swap-oob="beforeend">
    <div id="{{ toast_id }}" 
         data-toast-message="{{ message|e }}"
         data-toast-type="{{ type|e }}"
         data-toast-duration="{{ duration }}"
         class="toast glass rounded-lg p-4 border pointer-events-auto shadow-lg min-w-[300px] max-w-[400px] {{ config.border }} {{ config.bg }} animate-fade-in"
         x-data="{ 
             init() {
                 // Initialize Lucide icons
                 if (typeof lucide !== 'undefined') {
                     this.$nextTick(() => lucide.createIcons());
                 }
                 // Auto-dismiss after duration
                 setTimeout(() => {
                     this.$el.classList.add('fade-out');
                     setTimeout(() => {
                         if (this.$el && this.$el.parentNode) {
                             this.$el.remove();
                         }
                     }, 300);
                 }, {{ duration }});
             }
         }">
        <div class="flex items-start gap-3">
            <i data-lucide="{{ config.icon }}" class="{{ config.icon_color }} text-lg mt-0.5 flex-shrink-0 w-5 h-5"></i>
            <div class="flex-1 min-w-0">
                <p class="text-sm font-semibold text-white break-words">{{ message|e }}</p>
                {% if undo_action and undo_symbol %}
                <div class="mt-2">
                    <button 
                        hx-post="{{ undo_action }}"
                        hx-vals='{{ {"action": "add", "symbol": undo_symbol} | tojson }}'
                        hx-target="#watch-list"
                        hx-swap="innerHTML"
                        @click="$el.closest('.toast').classList.add('fade-out'); setTimeout(() => $el.closest('.toast').remove(), 300)"
                        class="text-xs font-semibold text-green-400 hover:text-green-300 underline transition">
                        Undo
                    </button>
                </div>
                {% endif %}
            </div>
            <button @click="$el.closest('.toast').classList.add('fade-out'); setTimeout(() => $el.closest('.toast').remove(), 300)" 
                    class="text-gray-400 hover:text-white transition flex-shrink-0">
                <i data-lucide="x" class="text-xs w-3 h-3"></i>
            </button>
        </div>
    </div>
</div>
