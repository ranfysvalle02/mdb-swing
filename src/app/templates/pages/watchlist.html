<div class="glass-panel rounded-2xl p-4 border border-blue-500/20" role="region" aria-label="Watch list">
    <!-- Compact Header with Ready Count -->
    <div class="flex items-center justify-between mb-1">
        <div class="flex items-center gap-1.5">
            <i data-lucide="list" class="text-blue-400 w-3.5 h-3.5" aria-hidden="true"></i>
            <h3 class="text-xs text-gray-300 font-semibold">Watch List</h3>
            {% if ready_count > 0 %}
            <span class="text-[10px] text-green-400 font-semibold ml-1.5" aria-label="{{ ready_count }} {% if ready_count == 1 %}candidate{% else %}candidates{% endif %} ready">({{ ready_count }} {% if ready_count == 1 %}candidate{% else %}candidates{% endif %})</span>
            {% endif %}
        </div>
        <span class="text-[10px] text-gray-400" aria-label="{{ symbols|length }} {% if symbols|length == 1 %}ticker{% else %}tickers{% endif %} in watch list">{{ symbols|length }} {% if symbols|length == 1 %}ticker{% else %}tickers{% endif %}</span>
    </div>
    
    {% if ready_count > 0 %}
    <div class="text-[11px] text-green-400 mb-1.5 flex items-center gap-2 px-3 py-2 rounded-lg bg-green-500/10 border border-green-500/30" role="status" aria-live="polite">
        <i data-lucide="sparkles" class="w-4 h-4 text-green-400" aria-hidden="true"></i>
        <span class="font-semibold"><span class="text-green-300">{{ ready_count }}</span> {% if ready_count == 1 %}candidate ready{% else %}candidates ready{% endif %} - Click green cards to analyze</span>
    </div>
    {% else %}
    <div class="text-[11px] text-gray-500 mb-1.5 flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800/30 border border-gray-700/30" role="status" aria-live="polite">
        <i data-lucide="info" class="w-4 h-4" aria-hidden="true"></i>
        <span>Add stocks - candidates (RSI &lt; {{ rsi_threshold|default(35) }}, uptrend) will appear with green highlight</span>
    </div>
    {% endif %}
    
    <!-- Single Row Horizontal Scroll Layout for Ticker Cards -->
    <div class="relative mb-1.5" id="watchlist-scroll-wrapper">
        <button 
            id="watchlist-scroll-left" 
            class="watchlist-nav-btn watchlist-nav-btn-left" 
            aria-label="Scroll left"
            disabled>
            <i data-lucide="chevron-left" class="w-5 h-5"></i>
        </button>
        <div class="watchlist-scroll-container flex flex-row gap-3 px-10" id="ticker-cards-container" role="list" aria-label="Watch list ticker cards">
            {% if preview_data %}
                {% for card in preview_data %}
                    {# Use pre-calculated values from backend - no need to recalculate #}
                    {% set symbol = card.symbol %}
                    {% set price = card.get('price') %}
                    {% set rsi = card.get('rsi') %}
                    {% set trend = card.get('trend') %}
                    {% set meets_criteria = card.get('meets_criteria', false) %}
                    {% set rsi_color = card.get('rsi_color', 'text-gray-400') %}
                    {% set trend_icon = card.get('trend_icon', 'minus') %}
                    {% set trend_color = card.get('trend_color', 'text-gray-400') %}
                    {% set border_class = card.get('border_class', 'border-blue-500/30') %}
                    {% set bg_class = card.get('bg_class', 'bg-blue-500/5') %}
                    {% set sma_200 = card.get('sma_200') %}
                    {% set atr = card.get('atr') %}
                    {% set price_vs_sma_pct = card.get('price_vs_sma_pct') %}
                    {% set price_vs_sma_color = card.get('price_vs_sma_color', 'text-gray-400') %}
                    {% set price_vs_sma_icon = card.get('price_vs_sma_icon', 'minus') %}
                    {% set rejection_reason = card.get('rejection_reason') %}
                    {% set rsi_progress_pct = card.get('rsi_progress_pct') %}
                    {% set sma_progress_pct = card.get('sma_progress_pct') %}
                    {% set volume = card.get('volume') %}
                    {% set earnings_in_days = card.get('earnings_in_days') %}
                    {% set pe_ratio = card.get('pe_ratio') %}
                    {% set market_cap = card.get('market_cap') %}
                    {% set logo_svg = card.get('logo_svg') %}
                    {% set rsi_threshold = rsi_threshold|default(35) %}
                    {% set sma_proximity_pct = sma_proximity_pct|default(3.0) %}
                    {% include "components/watchlist_card.html" %}
                {% endfor %}
            {% elif symbols %}
                {% for symbol in symbols %}
                    {% set price = none %}
                    {% set rsi = none %}
                    {% set trend = none %}
                    {% set meets_criteria = false %}
                    {% set rsi_color = "text-gray-400" %}
                    {% set trend_icon = "minus" %}
                    {% set trend_color = "text-gray-400" %}
                    {% set border_class = "border-blue-500/30" %}
                    {% set bg_class = "bg-blue-500/5" %}
                    {% include "components/watchlist_card.html" %}
                {% endfor %}
            {% else %}
                <div class="flex-shrink-0 w-full text-center py-3 text-gray-400" role="status" aria-live="polite">
                    <i data-lucide="eye-off" class="w-4 h-4 mx-auto mb-1" aria-hidden="true"></i>
                    <p class="text-[10px]">No tickers yet</p>
                </div>
            {% endif %}
        </div>
        <button 
            id="watchlist-scroll-right" 
            class="watchlist-nav-btn watchlist-nav-btn-right" 
            aria-label="Scroll right"
            disabled>
            <i data-lucide="chevron-right" class="w-5 h-5"></i>
        </button>
    </div>
    
    <!-- Compact Add Ticker -->
    <form 
        id="add-ticker-form"
        hx-post="/api/watch-list"
        hx-target="#watch-list"
        hx-swap="innerHTML"
        hx-indicator="#add-ticker-loading"
        class="flex gap-1.5">
        <div class="flex-1">
            <input 
                type="text" 
                id="add-ticker-input" 
                name="symbol"
                class="w-full px-2 py-1.5 rounded-lg text-xs text-white font-mono uppercase"
                placeholder="Add ticker..."
                maxlength="5"
                style="text-transform: uppercase;"
                autocomplete="off"
                aria-label="Add ticker symbol"
                aria-describedby="ticker-input-help"
            />
            <input type="hidden" name="action" value="add">
            <div id="ticker-input-help" class="sr-only">Enter a stock ticker symbol to add to watch list</div>
        </div>
        <button 
            type="submit"
            id="add-ticker-btn"
            class="btn-glass px-3 py-1.5 rounded-lg text-xs font-semibold text-white hover:bg-blue-600/30 transition-all border border-blue-500/30 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
            aria-label="Add ticker to watch list">
            <span id="add-ticker-loading" class="htmx-indicator">
                <i data-lucide="loader-2" class="w-3.5 h-3.5 lucide-spin"></i>
            </span>
            <i data-lucide="plus" class="w-3.5 h-3.5 htmx-indicator-hidden"></i>
        </button>
    </form>
</div>
{% include "scripts/watchlist_dropdown.html" %}
